#!/bin/sh

COPYRIGHT="
Copyright (C) 2012-2014  A. Gordon (assafgordon@gmail.com)
License: GPLv3+
"

## Helper script to automatically view a tabular file
## with properly tabulated fields.
## See "detect_tab_stops --help" for details.
##

die()
{
    BASE=$(basename -- "$0")
    echo "$BASE: error: $@" >&2
    exit 1
}

usage()
{
	BASE=$(basename $0)
	echo "
atexpand - Print a file, with automatic tab expantion
Version: @VERSION@
$COPYRIGHT
Usage:
  $BASE [INPUT-FILE]

Will read INPUT-FILE, and output (to STDOUT) the file,
after expanding TABS to spaces, ensuring adequete spaces are
inserted to align all fields properly (uses 'detect_tab_stops'
to calculate tab expansion).

Equivalent to:
  expand -tN1,N2,N3,N4,N5,... INPUT-FILE
while automatically calculating N1,N2,N3,N4 for optimal viewing.

"
    exit
}

FILE=$1
test -z "$FILE" && die "Missing input file name. See --help for details."
test "x$1" = "x-h" || test "x$1" = "x--help" && usage

test -e "$FILE" || die "file '$FILE' not found."
test -r "$FILE" || die "Input file must be a regular file (not a pipe/socket)"

expand -t$(detect_tab_stops "$FILE") -- "$FILE" \
    || die "expand failed on '$FILE'"
